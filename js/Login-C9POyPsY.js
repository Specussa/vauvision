import{_ as A}from"./auth-D_GbeW7X.js";import{v as B,h as L}from"./@element-plus-m0wAbjkV.js";import{s as E,a as z}from"./api-DCacf_kA.js";import{r as T,T as v}from"./index-BLWP-N8F.js";import{L as U}from"./Logo-DW9bQPPr.js";import{E as i}from"./element-plus-3NUcAjFf.js";import{d as $,Z as w,b as h,c as m,a as s,U as d,O as p,u,I as y,T as k,R as V,ai as f,o as n,M as x}from"./@vue-DwLU1mub.js";import"./axios-BimPEqV4.js";import"./vue-router-CPimp6oI.js";import"./vue-i18n-DcgfqTZL.js";import"./@intlify-CQT3u4ju.js";import"./vue-tel-input-BsVA42h1.js";import"./lodash-es-CiJSjksT.js";import"./@vueuse-Q_cOxmjC.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-Ct2Knyoi.js";import"./async-validator-DKvM95Vc.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-DF51-gJp.js";const D={class:"auth"},I={class:"auth__container container"},N={class:"auth__block"},S={class:"auth__flex"},q={class:"auth__left"},F={class:"auth__left_left"},G={class:"auth__logo"},O={class:"auth__right"},Z={class:"auth__top"},j={class:"auth__form"},H={class:"form__flex"},J={class:"form__group"},K={key:0,class:"error text_very"},P={class:"form__group"},Q={key:0,class:"error text_very"},W={class:"form__group form__row"},X={class:"form__buttons"},Y=["disabled","loading"],ee={key:0},se={key:1},xe=$({__name:"Login",setup(ae){const o=w({email:"",password:"",rememberMe:!1}),t=w({email:"",password:""}),_=h(!1),l=h(!1),c=()=>{let a=!0;return t.email="",t.password="",o.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.email.trim())||(t.email="Введите корректный email адрес",a=!1):(t.email="Email обязателен для заполнения",a=!1),o.password?o.password.length<6&&(t.password="Пароль должен содержать минимум 6 символов",a=!1):(t.password="Пароль обязателен для заполнения",a=!1),a},C=async()=>{c()&&(l.value=!0,await E("post","/api/v1/auth/login/",{email:o.email.trim(),password:o.password,remember_me:o.rememberMe}).then(a=>{console.log("Успешный вход:",a.data),a.data.access&&a.data.refresh?(z(a.data.access,a.data.refresh),i({message:"Вход выполнен успешно!",type:"success"}),o.email="",o.password="",o.rememberMe=!1,T.push(v.i18nRoute({name:""}))):(console.error("Неожиданная структура ответа:",a.data),i({message:"Ошибка при обработке ответа сервера",type:"error"}))}).catch(a=>{if(console.error("Ошибка при входе:",a),a.response&&a.response.data){const e=a.response.data;e.email&&(t.email=Array.isArray(e.email)?e.email[0]:e.email),e.password&&(t.password=Array.isArray(e.password)?e.password[0]:e.password),!e.email&&!e.password&&e.detail?i({message:e.detail,type:"error"}):!e.email&&!e.password&&e.non_field_errors?i({message:Array.isArray(e.non_field_errors)?e.non_field_errors[0]:e.non_field_errors,type:"error"}):!e.email&&!e.password&&i({message:"Ошибка авторизации. Проверьте введенные данные.",type:"error"})}else a.message?i({message:a.message,type:"error"}):i({message:"Произошла ошибка при подключении к серверу",type:"error"})}).finally(()=>{l.value=!1}))};return(a,e)=>{const b=f("RouterLink"),g=f("el-input"),M=f("el-icon"),R=f("el-checkbox");return n(),m("section",D,[s("div",I,[s("div",N,[s("div",S,[s("div",q,[s("div",F,[s("div",G,[d(U)]),e[6]||(e[6]=s("div",{class:"auth__info"},[s("h3",{class:"auth__heading"},"Стань известным и популярным в мире музыки"),s("p",{class:"auth__description"},"Выложи трек на все площадки и продавай свою музыку во всем мире")],-1))]),e[7]||(e[7]=s("div",{class:"auth__image"},[s("img",{src:A,alt:"cover"})],-1))]),s("div",O,[s("div",Z,[e[9]||(e[9]=s("p",{class:"auth__acc text_small"},"У вас нет аккаунта?",-1)),d(b,{class:"auth__login button__second button",to:u(v).i18nRoute({name:"registration"})},{default:p(()=>e[8]||(e[8]=[s("span",null,"Зарегистрироваться",-1)])),_:1},8,["to"])]),s("div",j,[e[13]||(e[13]=s("div",{class:"form__heading"},[s("h1",{class:"form__head title_two"},"Вход")],-1)),s("div",H,[s("div",J,[e[10]||(e[10]=s("label",{for:"email",class:"form__label button"},"E-mail",-1)),d(g,{id:"email",modelValue:o.email,"onUpdate:modelValue":e[0]||(e[0]=r=>o.email=r),type:"email",class:y({error:t.email}),placeholder:"Введите ваш e-mail",disabled:l.value,onBlur:c,onInput:e[1]||(e[1]=r=>t.email=""),size:"large"},null,8,["modelValue","class","disabled"]),t.email?(n(),m("div",K,k(t.email),1)):V("",!0)]),s("div",P,[e[11]||(e[11]=s("label",{for:"password",class:"form__label button"},"Пароль",-1)),d(g,{id:"password",modelValue:o.password,"onUpdate:modelValue":e[3]||(e[3]=r=>o.password=r),type:_.value?"text":"password",class:y({error:t.password}),placeholder:"Введите пароль",disabled:l.value,onBlur:c,onInput:e[4]||(e[4]=r=>t.password=""),size:"large"},{suffix:p(()=>[d(M,{onClick:e[2]||(e[2]=r=>_.value=!_.value),style:{color:"var(--el-text-color-placeholder)"}},{default:p(()=>[_.value?(n(),x(u(B),{key:0})):(n(),x(u(L),{key:1}))]),_:1})]),_:1},8,["modelValue","type","class","disabled"]),t.password?(n(),m("div",Q,k(t.password),1)):V("",!0)]),s("div",W,[d(R,{modelValue:o.rememberMe,"onUpdate:modelValue":e[5]||(e[5]=r=>o.rememberMe=r),disabled:l.value,label:"Запомнить меня",size:"large"},null,8,["modelValue","disabled"]),d(b,{class:"auth__forgot button__second button",to:u(v).i18nRoute({name:"restore"})},{default:p(()=>e[12]||(e[12]=[s("span",null,"Забыли пароль?",-1)])),_:1},8,["to"])])]),s("div",X,[s("button",{class:"form__send button__black button",onClick:C,disabled:l.value,loading:l.value},[l.value?(n(),m("span",se,"Загрузка...")):(n(),m("span",ee,"Войти"))],8,Y)])])])])])])])}}});export{xe as default};
