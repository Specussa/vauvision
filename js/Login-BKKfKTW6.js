import{_ as L}from"./auth-D_GbeW7X.js";import{v as B,h as M}from"./@element-plus-m0wAbjkV.js";import{s as E,a as S}from"./api-DCacf_kA.js";import{r as z,T as v}from"./index-BGeyuqtG.js";import{L as D}from"./Logo-BoKzTO4B.js";import{E as i}from"./element-plus-3NUcAjFf.js";import{d as I,Z as h,b as w,c as m,a as e,U as d,O as p,u,I as y,T as k,R as V,ai as f,o as n,M as x}from"./@vue-DwLU1mub.js";import"./axios-BimPEqV4.js";import"./vue-router-CPimp6oI.js";import"./vue-i18n-DcgfqTZL.js";import"./@intlify-CQT3u4ju.js";import"./vue-tel-input-BsVA42h1.js";import"./lodash-es-CiJSjksT.js";import"./@vueuse-Q_cOxmjC.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-Ct2Knyoi.js";import"./async-validator-DKvM95Vc.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-DF51-gJp.js";const N={class:"auth"},T={class:"auth__container container"},U={class:"auth__block"},$={class:"auth__flex"},O={class:"auth__left"},G={class:"auth__left_left"},j={class:"auth__logo"},q={class:"auth__right"},F={class:"auth__top"},P={class:"auth__form"},W={class:"form__flex"},Z={class:"form__group"},H={key:0,class:"error text_very"},J={class:"form__group"},K={key:0,class:"error text_very"},Q={class:"form__group form__row"},X={class:"form__buttons"},Y=["disabled","loading"],ss={key:0},es={key:1},xs=I({__name:"Login",setup(as){const t=h({email:"",password:"",rememberMe:!1}),o=h({email:"",password:""}),_=w(!1),l=w(!1),c=()=>{let a=!0;return o.email="",o.password="",t.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email.trim())||(o.email="Введите корректный email адрес",a=!1):(o.email="Email обязателен для заполнения",a=!1),t.password?t.password.length<6&&(o.password="Пароль должен содержать минимум 6 символов",a=!1):(o.password="Пароль обязателен для заполнения",a=!1),a},R=async()=>{c()&&(l.value=!0,await E("post","/ajax/auth/login.php",{LOGIN:t.email.trim(),PASSWORD:t.password}).then(a=>{console.log("Успешный вход:",a.data),a.data.access&&a.data.refresh?(S(a.data.access,a.data.refresh),i({message:"Вход выполнен успешно!",type:"success"}),t.email="",t.password="",t.rememberMe=!1,z.push(v.i18nRoute({name:""}))):(console.error("Неожиданная структура ответа:",a.data),i({message:"Ошибка при обработке ответа сервера",type:"error"}))}).catch(a=>{if(console.error("Ошибка при входе:",a),a.response&&a.response.data){const s=a.response.data;s.email&&(o.email=Array.isArray(s.email)?s.email[0]:s.email),s.password&&(o.password=Array.isArray(s.password)?s.password[0]:s.password),!s.email&&!s.password&&s.detail?i({message:s.detail,type:"error"}):!s.email&&!s.password&&s.non_field_errors?i({message:Array.isArray(s.non_field_errors)?s.non_field_errors[0]:s.non_field_errors,type:"error"}):!s.email&&!s.password&&i({message:"Ошибка авторизации. Проверьте введенные данные.",type:"error"})}else a.message?i({message:a.message,type:"error"}):i({message:"Произошла ошибка при подключении к серверу",type:"error"})}).finally(()=>{l.value=!1}))};return(a,s)=>{const b=f("RouterLink"),g=f("el-input"),A=f("el-icon"),C=f("el-checkbox");return n(),m("section",N,[e("div",T,[e("div",U,[e("div",$,[e("div",O,[e("div",G,[e("div",j,[d(D)]),s[6]||(s[6]=e("div",{class:"auth__info"},[e("h3",{class:"auth__heading"},"Стань известным и популярным в мире музыки"),e("p",{class:"auth__description"},"Выложи трек на все площадки и продавай свою музыку во всем мире")],-1))]),s[7]||(s[7]=e("div",{class:"auth__image"},[e("img",{src:L,alt:"cover"})],-1))]),e("div",q,[e("div",F,[s[9]||(s[9]=e("p",{class:"auth__acc text_small"},"У вас нет аккаунта?",-1)),d(b,{class:"auth__login button__second button",to:u(v).i18nRoute({name:"registration"})},{default:p(()=>s[8]||(s[8]=[e("span",null,"Зарегистрироваться",-1)])),_:1},8,["to"])]),e("div",P,[s[13]||(s[13]=e("div",{class:"form__heading"},[e("h1",{class:"form__head title_two"},"Вход")],-1)),e("div",W,[e("div",Z,[s[10]||(s[10]=e("label",{for:"email",class:"form__label button"},"E-mail",-1)),d(g,{id:"email",modelValue:t.email,"onUpdate:modelValue":s[0]||(s[0]=r=>t.email=r),type:"email",class:y({error:o.email}),placeholder:"Введите ваш e-mail",disabled:l.value,onBlur:c,onInput:s[1]||(s[1]=r=>o.email=""),size:"large"},null,8,["modelValue","class","disabled"]),o.email?(n(),m("div",H,k(o.email),1)):V("",!0)]),e("div",J,[s[11]||(s[11]=e("label",{for:"password",class:"form__label button"},"Пароль",-1)),d(g,{id:"password",modelValue:t.password,"onUpdate:modelValue":s[3]||(s[3]=r=>t.password=r),type:_.value?"text":"password",class:y({error:o.password}),placeholder:"Введите пароль",disabled:l.value,onBlur:c,onInput:s[4]||(s[4]=r=>o.password=""),size:"large"},{suffix:p(()=>[d(A,{onClick:s[2]||(s[2]=r=>_.value=!_.value),style:{color:"var(--el-text-color-placeholder)"}},{default:p(()=>[_.value?(n(),x(u(B),{key:0})):(n(),x(u(M),{key:1}))]),_:1})]),_:1},8,["modelValue","type","class","disabled"]),o.password?(n(),m("div",K,k(o.password),1)):V("",!0)]),e("div",Q,[d(C,{modelValue:t.rememberMe,"onUpdate:modelValue":s[5]||(s[5]=r=>t.rememberMe=r),disabled:l.value,label:"Запомнить меня",size:"large"},null,8,["modelValue","disabled"]),d(b,{class:"auth__forgot button__second button",to:u(v).i18nRoute({name:"restore"})},{default:p(()=>s[12]||(s[12]=[e("span",null,"Забыли пароль?",-1)])),_:1},8,["to"])])]),e("div",X,[e("button",{class:"form__send button__black button",onClick:R,disabled:l.value,loading:l.value},[l.value?(n(),m("span",es,"Загрузка...")):(n(),m("span",ss,"Войти"))],8,Y)])])])])])])])}}});export{xs as default};
