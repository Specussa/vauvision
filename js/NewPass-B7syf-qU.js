import{_ as R}from"./auth-D_GbeW7X.js";import{v as k,h as x}from"./@element-plus-m0wAbjkV.js";import{L as S}from"./Logo-BjNREyvW.js";import{s as $}from"./api-dDMw0Exz.js";import{u as z}from"./vue-router-CPimp6oI.js";import{T as D,_ as I}from"./index-DLLIllaA.js";import{E as l}from"./element-plus-3NUcAjFf.js";import{d as T,Z as V,b,c as p,a as e,U as m,O as y,I as A,T as C,R as P,u as c,ai as B,o as n,M as h}from"./@vue-DwLU1mub.js";import"./axios-BimPEqV4.js";import"./vue-i18n-DcgfqTZL.js";import"./@intlify-CQT3u4ju.js";import"./vue-tel-input-BsVA42h1.js";import"./lodash-es-CiJSjksT.js";import"./@vueuse-Q_cOxmjC.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-Ct2Knyoi.js";import"./async-validator-DKvM95Vc.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-DF51-gJp.js";const E={class:"auth"},F={class:"auth__container container"},M={class:"auth__block"},Z={class:"auth__flex"},j={class:"auth__left"},q={class:"auth__left_left"},G={class:"auth__logo"},O={class:"auth__right"},H={class:"auth__form"},J={class:"form__flex"},K={class:"form__group"},Q={key:0,class:"error text_very"},W={class:"form__group"},X={key:0,class:"error text_very"},Y={class:"form__buttons"},ss=["disabled"],os={key:0},es={key:1},rs=T({__name:"NewPass",setup(as){const N=z(),r=V({password:"",confirm:""}),a=V({password:"",confirm:""}),_=b(!1),f=b(!1),d=b(!1),U=()=>{const t=new URLSearchParams(window.location.search);return{id:t.get("id")||"",confirm_code:t.get("confirm_code")||""}},{id:u,confirm_code:w}=U(),g=()=>{let t=!0;if(a.password="",a.confirm="",!r.password)a.password="Пароль обязателен для заполнения",t=!1;else if(r.password.length<6)a.password="Пароль должен содержать минимум 6 символов",t=!1;else{const s=/[A-Z]/.test(r.password),o=/[a-z]/.test(r.password),v=/\d/.test(r.password),i=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(r.password);(!s||!o||!v||!i)&&(a.password="Пароль должен содержать заглавные и строчные буквы, цифры и специальные символы",t=!1)}return r.confirm?r.password!==r.confirm&&(a.confirm="Пароли не совпадают",t=!1):(a.confirm="Подтверждение пароля обязательно",t=!1),t},L=async()=>{if(!g())return;if(!u||!w){l({message:"Отсутствуют параметры для восстановления пароля",type:"error"});return}d.value=!0;const t={id:u,confirm_code:w,password:r.password,"password-confirm":r.confirm};try{const s=await $("post","/ajax/auth/changepass.php",t);console.log("Пароль успешно изменен:",s.data),l({message:"Пароль успешно изменен!",type:"success"}),r.password="",r.confirm="",setTimeout(()=>{N.push(D.i18nRoute({name:"login"}))},1500)}catch(s){if(console.error("Ошибка при восстановлении пароля:",s),s.response&&s.response.data){const o=s.response.data;o.password&&(a.password=Array.isArray(o.password)?o.password[0]:o.password),o["password-confirm"]&&(a.confirm=Array.isArray(o["password-confirm"])?o["password-confirm"][0]:o["password-confirm"]),o.id&&l({message:Array.isArray(o.id)?o.id[0]:o.id,type:"error"}),o.confirm_code&&l({message:Array.isArray(o.confirm_code)?o.confirm_code[0]:o.confirm_code,type:"error"}),o.detail?l({message:o.detail,type:"error"}):o.non_field_errors&&l({message:Array.isArray(o.non_field_errors)?o.non_field_errors[0]:o.non_field_errors,type:"error"})}else l({message:"Произошла ошибка при восстановлении пароля. Попробуйте еще раз.",type:"error"})}finally{d.value=!1}};return(!u||!w)&&l({message:"Недействительная ссылка для восстановления пароля",type:"warning"}),(t,s)=>{const o=B("el-icon"),v=B("el-input");return n(),p("section",E,[e("div",F,[e("div",M,[e("div",Z,[e("div",j,[e("div",q,[e("div",G,[m(S)]),s[6]||(s[6]=e("div",{class:"auth__info"},[e("h3",{class:"auth__heading"},"Стань известным и популярным в мире музыки"),e("p",{class:"auth__description"},"Выложи трек на все площадки и продавай свою музыку во всем мире")],-1))]),s[7]||(s[7]=e("div",{class:"auth__image"},[e("img",{src:R,alt:"cover"})],-1))]),e("div",O,[e("div",H,[s[10]||(s[10]=e("div",{class:"form__heading"},[e("h1",{class:"form__head title_two"},"Восстановление пароля")],-1)),e("div",J,[e("div",K,[s[8]||(s[8]=e("label",{for:"password",class:"form__label button"},"Новый пароль",-1)),m(v,{id:"password",modelValue:r.password,"onUpdate:modelValue":s[1]||(s[1]=i=>r.password=i),type:_.value?"text":"password",class:A({error:a.password}),placeholder:"Введите новый пароль",disabled:d.value,onBlur:g,onInput:s[2]||(s[2]=i=>a.password=""),size:"large"},{suffix:y(()=>[m(o,{onClick:s[0]||(s[0]=i=>_.value=!_.value),style:{color:"var(--el-text-color-placeholder)",cursor:"pointer"}},{default:y(()=>[_.value?(n(),h(c(k),{key:0})):(n(),h(c(x),{key:1}))]),_:1})]),_:1},8,["modelValue","type","class","disabled"]),a.password?(n(),p("div",Q,C(a.password),1)):P("",!0)]),e("div",W,[s[9]||(s[9]=e("label",{for:"confirmPassword",class:"form__label button"},"Повторите пароль",-1)),m(v,{id:"confirmPassword",modelValue:r.confirm,"onUpdate:modelValue":s[4]||(s[4]=i=>r.confirm=i),type:f.value?"text":"password",class:A({error:a.confirm}),placeholder:"Повторите новый пароль",disabled:d.value,onBlur:g,onInput:s[5]||(s[5]=i=>a.confirm=""),size:"large"},{suffix:y(()=>[m(o,{onClick:s[3]||(s[3]=i=>f.value=!f.value),style:{color:"var(--el-text-color-placeholder)",cursor:"pointer"}},{default:y(()=>[f.value?(n(),h(c(k),{key:0})):(n(),h(c(x),{key:1}))]),_:1})]),_:1},8,["modelValue","type","class","disabled"]),a.confirm?(n(),p("div",X,C(a.confirm),1)):P("",!0)])]),e("div",Y,[e("button",{class:"form__send button__black button",onClick:L,disabled:d.value||!c(u)||!c(w)},[d.value?(n(),p("span",es,"Загрузка...")):(n(),p("span",os,"восстановить пароль"))],8,ss)])])])])])])])}}}),Cs=I(rs,[["__scopeId","data-v-2730a77f"]]);export{Cs as default};
